<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Horticalc GUI</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="compact">
    <header class="page-header">
      <h1>Horticalc – Düngercalculator</h1>
      <div class="api-config">
        <label for="apiBase">API Base URL</label>
        <input id="apiBase" type="url" value="http://localhost:8000" />
        <button id="reloadData">Dünger laden</button>
      </div>
    </header>

    <main class="gap-3">
      <section class="block" id="modeSection">
        <h2>Modus</h2>
        <div class="mode-toggle">
          <label>
            <input type="radio" name="modeToggle" value="calculator" checked />
            Rezept
          </label>
          <label>
            <input type="radio" name="modeToggle" value="solver" />
            Solver Recipe
          </label>
        </div>
      </section>

      <section class="block" id="waterSection">
        <div class="section-header">
          <h2>Wasserwerte</h2>
          <button class="toggle-button" id="toggleWaterValues" type="button">Wasserwerte anzeigen</button>
        </div>
        <div class="water-content is-collapsed" id="waterContent">
          <p class="hint">Profile lokal speichern/laden und Osmose-Anteil berücksichtigen.</p>
          <div class="water-controls">
            <div class="water-control-group">
              <label for="waterProfileSelect">Profil auswählen</label>
              <div class="water-control-row">
                <select id="waterProfileSelect"></select>
                <button id="loadWaterProfile" type="button">Laden</button>
                <button id="resetWaterProfile" type="button">Reset Default</button>
              </div>
            </div>
            <div class="water-control-group">
              <label for="waterProfileName">Profilname zum Speichern</label>
              <div class="water-control-row">
                <input id="waterProfileName" type="text" placeholder="z.B. stadenburdenhard" />
                <button id="saveWaterProfile" type="button">Speichern</button>
              </div>
            </div>
            <div class="water-control-group water-settings">
              <div>
                <label for="osmosisPercent">Osmoseanteil (%)</label>
                <input id="osmosisPercent" type="number" min="0" max="100" step="1" value="0" />
              </div>
              <label class="toggle">
                <input id="waterUnitToggle" type="checkbox" />
                <span>mol/L Eingabe & Anzeige</span>
              </label>
            </div>
          </div>
          <div class="table-wrap">
            <table class="grid grid--form" id="waterValuesTable">
              <thead>
                <tr>
                  <th>Parameter</th>
                  <th>Wert</th>
                  <th>Einheit</th>
                </tr>
              </thead>
              <tbody>
                <!-- rows inserted by JS -->
              </tbody>
            </table>
          </div>
          <p class="hint">CO3 / CaCO3 / °KH sind Helfer: jede Eingabe überschreibt HCO3.</p>
        </div>
      </section>

      <div class="mode-panel" id="calculatorMode">
        <section class="block" id="recipeSection">
          <h2>Rezepte</h2>
          <p class="hint">Profile lokal speichern/laden.</p>
          <div class="water-controls">
            <div class="water-control-group">
              <label for="recipeProfileSelect">Profil auswählen</label>
              <div class="water-control-row">
                <select id="recipeProfileSelect"></select>
                <button id="loadRecipeProfile" type="button">Laden</button>
                <button id="resetRecipeProfile" type="button">Reset Default</button>
              </div>
            </div>
            <div class="water-control-group">
              <label for="recipeProfileName">Profilname zum Speichern</label>
              <div class="water-control-row">
                <input id="recipeProfileName" type="text" placeholder="z.B. standard_mix" />
                <button id="saveRecipeProfile" type="button">Speichern</button>
              </div>
            </div>
          </div>
        </section>
        <section class="block">
          <h2>Vorauswahl der Düngerkomponenten</h2>
          <div class="actions inline-actions">
            <button id="addFertilizerRow" type="button">+</button>
            <button id="removeFertilizerRow" type="button">-</button>
            <span class="inline-hint">Wähle Dünger aus der Datenbank, das Plus fügt weitere Zeilen hinzu.</span>
          </div>
          <div class="table-wrap" id="fertilizerSelectTableWrap"></div>
        </section>

        <section class="block">
          <h2>Düngercalculator</h2>
          <p class="hint">Mengen eingeben und Berechnung starten.</p>
          <div class="table-wrap" id="calculatorTableWrap"></div>
          <div class="actions">
            <button id="calculateBtn">Berechnen</button>
          </div>
          <div class="summary">
            <div class="summary-metrics">
              <div class="summary-metric-card">
                <div class="metric-label">NPK Gesamt (%)</div>
                <div class="metric-value" id="npkAllPct">-</div>
              </div>
              <div class="summary-metric-card">
                <div class="metric-label">NPK P-Norm</div>
                <div class="metric-value" id="npkPNorm">-</div>
              </div>
              <div class="summary-metric-card">
                <div class="metric-label">NPK Verhältnis (%)</div>
                <div class="metric-value" id="npkNpkPct">-</div>
              </div>
              <div class="summary-metric-card">
                <div class="metric-label">EC Werte</div>
                <div class="metric-row">
                  <span class="metric-label">Wasserwerte: EC18/25</span>
                  <span class="metric-value">
                    <span id="ecWater18Value">-</span>/<span id="ecWater25Value">-</span>
                  </span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Wasser + Dünger: EC18/25</span>
                  <span class="metric-value">
                    <span id="ec18Value">-</span>/<span id="ec25Value">-</span>
                  </span>
                </div>
              </div>
            </div>
            <div class="table-card">
              <h3>Oxidformen & Ionen (ppm, mg/l)</h3>
              <div class="table-wrap">
                <table class="grid grid--matrix nutrient-grid nutrient-grid--summary" id="summaryTable"></table>
              </div>
            </div>
          </div>
        </section>

        <section class="block">
          <h2>Ionenbilanz</h2>
            <div class="data-grid">
              <div class="table-card compact-card">
                <div class="table-card-title">
                  <h3>Ionen</h3>
                  <span class="table-badge">meq/L</span>
                </div>
                <div class="compact-table-wrap" id="ionMeqList"></div>
              </div>
              <div class="table-card compact-card">
                <h3>Bilanz</h3>
                <div class="compact-table-wrap compact-table-wrap--balance" id="ionBalanceList"></div>
              </div>
            </div>
        </section>
      </div>

      <div class="mode-panel is-hidden" id="solverMode">
        <section class="block">
          <h2>Solver Recipe</h2>
          <p class="hint">Zielwerte, erlaubte Dünger und fixe Grammangaben definieren.</p>
          <div class="water-controls">
            <div class="water-control-group">
              <label for="nutrientSolutionSelect">Profil auswählen</label>
              <div class="water-control-row">
                <select id="nutrientSolutionSelect"></select>
                <button id="loadNutrientSolution" type="button">Laden</button>
                <button id="resetNutrientSolution" type="button">Reset Default</button>
              </div>
            </div>
            <div class="water-control-group">
              <label for="nutrientSolutionName">Profilname zum Speichern</label>
              <div class="water-control-row">
                <input id="nutrientSolutionName" type="text" placeholder="z.B. hoagland_custom" />
                <button id="saveNutrientSolution" type="button">Speichern</button>
              </div>
            </div>
          </div>
          <div class="solver-settings">
            <label>
              Liter
              <input id="solverLiters" type="number" min="0.1" step="0.1" value="10" />
            </label>
            <label class="toggle">
              <input id="solverUreaToggle" type="checkbox" />
              <span>Harnstoff als NH4 behandeln</span>
            </label>
            <label>
              Phosphat-Spezies
              <select id="solverPhosphate">
                <option value="H2PO4">H2PO4</option>
                <option value="HPO4">HPO4</option>
              </select>
            </label>
          </div>
          <div class="solver-columns">
            <div class="solver-column">
              <h3>Zielwerte (mg/L)</h3>
              <div class="table-wrap">
                <table class="grid grid--form" id="solverTargetsTable">
                  <thead>
                    <tr>
                      <th>Element</th>
                      <th>Ziel</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
            <div class="solver-column">
              <h3>Erlaubte Dünger</h3>
              <select id="solverAllowedFertilizers" multiple></select>
              <h3>Fixe Gramm</h3>
              <div class="table-wrap">
                <table class="grid grid--form" id="solverFixedTable">
                  <thead>
                    <tr>
                      <th>Dünger</th>
                      <th>Fix (g)</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="actions">
            <button id="solveBtn" type="button">Solve</button>
            <button id="applySolverRecipe" type="button">Im Düngerrechner übernehmen</button>
          </div>
          <div class="solver-results">
            <div class="table-wrap">
              <table class="grid grid--form" id="solverFertilizersTable">
                <thead>
                  <tr>
                    <th>Dünger</th>
                    <th>Gramm</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <div class="table-wrap">
              <table class="grid grid--form" id="solverTargetsResultsTable">
                <thead>
                  <tr>
                    <th>Element</th>
                    <th>Ziel</th>
                    <th>Erreicht</th>
                    <th>Delta</th>
                    <th>Delta %</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div class="water-controls">
            <div class="water-control-group">
              <label for="solverRecipeName">Profilname zum Speichern</label>
              <div class="water-control-row">
                <input id="solverRecipeName" type="text" placeholder="z.B. solver_output" />
                <button id="saveSolverRecipe" type="button">Als Recipe speichern</button>
              </div>
            </div>
          </div>
        </section>
      </div>

    </main>

    <script src="app.js"></script>
  </body>
</html>
